<?php
<<<<<<< HEAD
$lang = $this->model('lang');
$lower_cat_label = strtolower($lang['cat.label']);

=======
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd

$category = $this->category;


<<<<<<< HEAD
$this->layout()->appendSection('layout.head', <<<EndJS
=======
$this->layout()->appendSection('layout.head', '
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd
<script type="text/javascript">

	$(document).ready(function() {

		cpv_trigger = $("input#cpv_trigger");
		cpv_target = $("#cpv_target");

<<<<<<< HEAD
		$('#cpv_target input:checkbox').live('click', function() {
			cpvChangeSelection($(this).val(), $(this).prop('checked'));
		});

		$('#cpv_listall input:checkbox').live('click', function() {
			cpvChangeSelection($(this).val(), $(this).prop('checked'));
		});

		cpvLookup();

		var del_button = $('<input type="submit" name="submitdelete" value="Delete {$lang['cat.label']}" />');
		del_button.click(function () {
			return confirm('Please confirm that you want to delete this {$lower_cat_label}.\\n\\nAny Items associated with this category will remain, but no longer be registered with it.\\n\\nThis operation cannot be undone.');
		});
		$('#delete_button_container').append(del_button);

	});

</script>
EndJS
);
?>

<?php
Ecl_Helper_Html::form('categoryform', $this->router()->makeAbsoluteUri('/admin/categories/edit/?id='. $this->category->id) );
Ecl_Helper_Html::formHidden('session_key', $this->model('user')->getSessionKey());
?>


<input type="submit" name="submitsave0" value="Save Changes" style="position: absolute; left: -100%;" />

=======
		$(\'#cpv_target input:checkbox\').live(\'click\', function() {
			cpvChangeSelection($(this).val(), $(this).prop(\'checked\'));
		});

		$(\'#cpv_listall input:checkbox\').live(\'click\', function() {
			cpvChangeSelection($(this).val(), $(this).prop(\'checked\'));
		});

		cpvLookup();
		var del_button = $("<div style=\"margin-bottom: 1em;\"><a href=\"#\">Delete category</a></div>");
		del_button.click(function () {
			$(\'#dialog-category\').html(\'Category: ' . $category->name . '\');
			$(\'#dialog\').dialog(\'open\');
		});
		$("#delete_button_container").append(del_button);

		//$( "#dialog:ui-dialog" ).dialog( "destroy" );
		$(\'#dialog\').dialog({
            modal: true,
            autoOpen: false,
            width: 400,
            modal: true,
            resizable: false,
            buttons: {
                "Delete": function() {
                	$(\'#submitdelete\').val(\'1\');
                    $(\'#categoryform\').submit();
                },
                "Cancel": function() {
                    $(this).dialog("close");
                }
            }
        });
	});

</script>
');
?>


<h1>Edit Category : <?php $this->out($this->category->name); ?></h1>
<p>Categories are used to group together items of equipment with a similar purpose or functionality.</p>
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd

<div id="delete_button_container"></div>


<<<<<<< HEAD
<h1>Edit <?php $this->out($lang['cat.label']); ?> : <?php $this->out($this->category->name); ?></h1>
<p><?php $this->out($lang['cat.label.plural']); ?> are used to group together items of equipment with a similar purpose or functionality.</p>


<?php
$this->render('categories_snippets_editsubform');
?>

=======
<?php
Ecl_Helper_Html::form('categoryform', $this->router()->makeAbsoluteUri('/admin/categories/edit/?id='. $this->category->id) );
Ecl_Helper_Html::formHidden('session_key', $this->model('user')->getSessionKey());
Ecl_Helper_Html::formHidden('submitdelete', '');

$this->render('categories_snippets_editsubform');

?>
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd
<div style="margin: 1em 0 2em 0;">
	<?php
	Ecl_Helper_Html::formSubmit('submitcancel', 'Cancel');
	Ecl_Helper_Html::formSubmit('submitsave', 'Save Changes');
	?>
</div>


<h3>Items Listed</h3>
<?php
if (0 < $category->item_count_internal) {
	?>
<<<<<<< HEAD
	<p>This <?php $this->out(strtolower($lang['cat.label'])); ?> contains <em><?php $this->out($category->item_count_internal); ?> item<?php echo ((1 < $category->item_count_internal) ? 's' : ''); ?></em> of equipment.</p>

	<p><a href="<?php echo $this->router()->makeAbsoluteUri("/browse/category-{$category->id}-".urlencode($category->name)); ?>">View items in catalogue</a></p>

	<p>If you would like to transfer your items to a different <?php $this->out(strtolower($lang['cat.label'])); ?>, please select a destination to transfer all items to.</p>
=======
	<p>This category contains <em><?php $this->out($category->item_count_internal); ?> item<?php echo ((1 < $category->item_count_internal) ? 's' : ''); ?></em> of equipment.</p>


	<p><a href="<?php echo $this->router()->makeAbsoluteUri("/category/{$category->slug}"); ?>">View items in catalogue</a></p>

	<p>If you would like to transfer your items to a different category, please select a destination to transfer all items to.</p>
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd
	<?php
	$options = array('' => '') + $this->model('categorystore')->findAll()->toAssoc('id', 'name');
	unset($options[$category->id]);

	Ecl_Helper_Html::formSelect('destination', $options);
	?>
	<br /><br />
	<?php
	$cboxes = array();
	$cboxes[] = array (
		'name'      => 'delete_on_transfer' ,
		'id'        => 'delete_on_transfer' ,
<<<<<<< HEAD
		'label'     => 'Delete current '. strtolower($lang['cat.label']).' after transfer' ,
=======
		'label'     => 'Delete current category after transfer' ,
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd
		'value'     => '1' ,
		'selected'  => false ,
	);
	Ecl_Helper_Html::formCheckboxTable($cboxes);
	?>
	<div>
		<?php Ecl_Helper_Html::formSubmit('submittransfer', 'Transfer Items'); ?>
	</div>
	<?php
} else {
	?>
<<<<<<< HEAD
	<p>This <?php $this->out(strtolower($lang['cat.label'])); ?> is not associated with any items.</p>
=======
	<p>This category is not associated with any items.</p>
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd
	<?php
}
?>


<?php
Ecl_Helper_Html::formClose();
?>

<<<<<<< HEAD

=======
<div id="dialog" title="Verify Delete Category">
<p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 0 0;"></span>Please confirm that you want to delete this category.</p><p>Any Items associated with this category will remain, but no longer be registered with the category.</p><p>This operation cannot be undone.</p>
<p id="dialog-category"></p>
</div>
>>>>>>> 593f5496075bbdb70e356142caa3cdea7c0271dd
