<?php
$dept = $this->dept;


$this->layout()->addGlobalJavascript();

$this->layout()->appendSection('layout.head', '
<script type="text/javascript">

	$(document).ready(function() {

		var del_button = $("<input type=\"submit\" name=\"submitdelete\" value=\"Delete Department\" />");
		del_button.click(function () {
			return confirm("Please confirm that this department and all its associated items will be deleted.\n\nThis operation cannot be undone.");
		});
		$("#delete_button_container").append(del_button);

	});

</script>
');
?>


<h1>Edit Department : <?php $this->out($dept->name); ?></h1>

<p>Here you can edit this department, or transfer its items to another.</p>

<?php
Ecl_Helper_Html::form('deptform', $this->request()->uri());
Ecl_Helper_Html::formHidden('session_key', $this->model('user')->getSessionKey());
?>

<div class="grid_row">

	<div class="grid_7col">

		<dl>
			<dt>Name</dt>
			<dd><?php Ecl_Helper_Html::formInput('name', 50, 250, $dept->name); ?></dd>
		</dl>

		<div style="text-align: center;">
			<?php Ecl_Helper_Html::formSubmit('submitsave', 'Save Changes'); ?>
		</div>

	</div>

	<div class="grid_5col grid_lastcol">

		<div id="delete_button_container"></div>

		<br style="clear: both;" />

		<div class="boxed" style="margin-top: 1em;">
			<p class="title">Items</p>
			<?php
			if (0 < $dept->item_count_internal) {
				?>
				<p>This department contains <em><?php $this->out($dept->item_count_internal); ?> item<?php echo ((1 < $dept->item_count_internal) ? 's' : ''); ?></em> of equipment.</p>
				<p><a href="<?php echo $this->router()->makeAbsoluteUri("/department/{$dept->url_suffix}"); ?>">View items in catalogue</a></p>

				<p class="title">Transfer Items</p>
				<p>Select a destination to transfer all items to.</p>
				<?php
				$options = array('' => '') + $this->model('departmentstore')->findAll()->toAssoc('id', 'name');
				unset($options[$dept->id]);

				Ecl_Helper_Html::formSelect('destination', $options);
				?>
				<br /><br />
				<?php
				$cboxes = array();
				$cboxes[] = array (
					'name'      => 'delete_on_transfer' ,
					'id'        => 'delete_on_transfer' ,
					'label'     => 'Delete current department after transfer' ,
					'value'     => '1' ,
					'selected'  => false ,
				);
				Ecl_Helper_Html::formCheckboxTable($cboxes);
				?>
				<div style="text-align: right;">
					<?php Ecl_Helper_Html::formSubmit('submittransfer', 'Transfer Items'); ?>
				</div>
				<?php
			} else {
				?>
				<p>This department contains no items.</p>
				<?php
			}
			?>

		</div>

	</div>


</div>

<?php
Ecl_Helper_Html::formClose();
?>